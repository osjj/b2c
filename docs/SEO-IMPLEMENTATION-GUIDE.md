# B2C Store SEO 实现指南

> 基于项目当前状态的完整SEO优化实施清单

## 目录

1. [当前状态评估](#1-当前状态评估)
2. [P0 - 基础SEO配置（必须立即实施）](#2-p0---基础seo配置必须立即实施)
3. [P1 - 动态页面SEO优化](#3-p1---动态页面seo优化)
4. [P2 - Admin端SEO配置功能](#4-p2---admin端seo配置功能)
5. [P3 - 进阶优化](#5-p3---进阶优化)
6. [验证清单](#6-验证清单)

---

## 1. 当前状态评估

### 1.1 现有问题

| 问题 | 当前状态 | 影响 |
|------|----------|------|
| Root Layout Metadata | 使用默认模板 `"Create Next App"` | 所有页面SEO基础缺失 |
| 动态页面Metadata | 产品/分类页无 `generateMetadata` | 搜索结果显示不友好 |
| sitemap.xml | 不存在 | 搜索引擎无法高效索引 |
| robots.txt | 不存在 | 爬虫行为不受控制 |
| 结构化数据 | 不存在 | 无法获得富媒体搜索结果 |
| OG/Twitter Cards | 未配置 | 社交分享效果差 |
| Admin SEO配置 | 不存在 | 无法灵活管理SEO内容 |

### 1.2 现有优势

- ✅ 产品/分类已有 `slug` 字段用于友好URL
- ✅ 产品/分类已有 `description` 字段
- ✅ ProductImage 表已有 `alt` 字段
- ✅ Setting 模型可用于存储全局SEO配置
- ✅ Next.js 16 原生支持 Metadata API

---

## 2. P0 - 基础SEO配置（必须立即实施）

### 2.1 任务：修复 Root Layout Metadata

**文件**: `src/app/layout.tsx`

**当前代码**:
```typescript
export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};
```

**修改为**:
```typescript
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: {
    default: "PPE Pro | Professional PPE Manufacturer",
    template: "%s | PPE Pro",
  },
  description:
    "Leading manufacturer of personal protective equipment. Safety gloves, shoes, workwear, and more. CE, ANSI, ISO9001 certified. OEM/ODM services available.",
  metadataBase: new URL(process.env.NEXT_PUBLIC_SITE_URL || "https://localhost:3000"),
  keywords: [
    "PPE",
    "safety gloves",
    "work gloves",
    "protective equipment",
    "safety shoes",
    "workwear",
  ],
  authors: [{ name: "PPE Pro" }],
  creator: "PPE Pro",
  publisher: "PPE Pro",
  formatDetection: {
    email: false,
    address: false,
    telephone: false,
  },
  openGraph: {
    type: "website",
    locale: "en_US",
    siteName: "PPE Pro",
    title: "PPE Pro | Professional PPE Manufacturer",
    description:
      "Leading manufacturer of personal protective equipment. Safety gloves, shoes, workwear, and more.",
    images: [
      {
        url: "/og-image.jpg", // 需要创建此图片
        width: 1200,
        height: 630,
        alt: "PPE Pro - Professional Safety Equipment",
      },
    ],
  },
  twitter: {
    card: "summary_large_image",
    title: "PPE Pro | Professional PPE Manufacturer",
    description:
      "Leading manufacturer of personal protective equipment. Safety gloves, shoes, workwear, and more.",
    images: ["/og-image.jpg"],
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      "max-video-preview": -1,
      "max-image-preview": "large",
      "max-snippet": -1,
    },
  },
  verification: {
    // 后续从 Admin 配置读取
    // google: "your-google-verification-code",
    // yandex: "your-yandex-verification-code",
  },
};
```

**环境变量** (`.env`):
```bash
NEXT_PUBLIC_SITE_URL=https://your-production-domain.com
```

**待办**:
- [ ] 创建 `public/og-image.jpg` (1200x630px)
- [ ] 更新 `.env` 中的 `NEXT_PUBLIC_SITE_URL`

---

### 2.2 任务：创建 sitemap.ts

**文件**: `src/app/sitemap.ts` (新建)

```typescript
import { MetadataRoute } from "next";
import prisma from "@/lib/prisma";

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://localhost:3000";

  // 获取所有活跃产品
  const products = await prisma.product.findMany({
    where: { isActive: true },
    select: { slug: true, updatedAt: true },
  });

  // 获取所有活跃分类
  const categories = await prisma.category.findMany({
    where: { isActive: true },
    select: { slug: true, updatedAt: true },
  });

  // 获取所有活跃集合
  const collections = await prisma.collection.findMany({
    where: { isActive: true },
    select: { slug: true, updatedAt: true },
  });

  // 静态页面
  const staticPages: MetadataRoute.Sitemap = [
    {
      url: baseUrl,
      lastModified: new Date(),
      changeFrequency: "daily",
      priority: 1,
    },
    {
      url: `${baseUrl}/products`,
      lastModified: new Date(),
      changeFrequency: "daily",
      priority: 0.9,
    },
    {
      url: `${baseUrl}/categories`,
      lastModified: new Date(),
      changeFrequency: "weekly",
      priority: 0.8,
    },
    {
      url: `${baseUrl}/about`,
      lastModified: new Date(),
      changeFrequency: "monthly",
      priority: 0.5,
    },
    {
      url: `${baseUrl}/cases`,
      lastModified: new Date(),
      changeFrequency: "monthly",
      priority: 0.5,
    },
    {
      url: `${baseUrl}/news`,
      lastModified: new Date(),
      changeFrequency: "weekly",
      priority: 0.6,
    },
  ];

  // 产品页面
  const productPages: MetadataRoute.Sitemap = products.map((product) => ({
    url: `${baseUrl}/products/${product.slug}`,
    lastModified: product.updatedAt,
    changeFrequency: "weekly" as const,
    priority: 0.8,
  }));

  // 分类页面
  const categoryPages: MetadataRoute.Sitemap = categories.map((category) => ({
    url: `${baseUrl}/categories/${category.slug}`,
    lastModified: category.updatedAt,
    changeFrequency: "weekly" as const,
    priority: 0.7,
  }));

  // 集合页面
  const collectionPages: MetadataRoute.Sitemap = collections.map((collection) => ({
    url: `${baseUrl}/collections/${collection.slug}`,
    lastModified: collection.updatedAt,
    changeFrequency: "weekly" as const,
    priority: 0.7,
  }));

  return [...staticPages, ...productPages, ...categoryPages, ...collectionPages];
}
```

**验证**:
- 访问 `https://your-domain.com/sitemap.xml` 确认生成正确

---

### 2.3 任务：创建 robots.ts

**文件**: `src/app/robots.ts` (新建)

```typescript
import { MetadataRoute } from "next";

export default function robots(): MetadataRoute.Robots {
  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://localhost:3000";

  return {
    rules: [
      {
        userAgent: "*",
        allow: "/",
        disallow: [
          "/admin/",
          "/api/",
          "/checkout/",
          "/account/",
          "/cart/",
          "/orders/",
          "/_next/",
          "/static/",
        ],
      },
      {
        userAgent: "Googlebot",
        allow: "/",
        disallow: ["/admin/", "/api/", "/checkout/", "/account/"],
      },
    ],
    sitemap: `${baseUrl}/sitemap.xml`,
    host: baseUrl,
  };
}
```

**验证**:
- 访问 `https://your-domain.com/robots.txt` 确认生成正确

---

## 3. P1 - 动态页面SEO优化

### 3.1 任务：产品详情页添加 generateMetadata

**文件**: `src/app/(store)/products/[slug]/page.tsx`

**在文件顶部添加**:
```typescript
import { Metadata } from "next";
import { getProductBySlug } from "@/actions/products";

type Props = {
  params: Promise<{ slug: string }>;
};

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { slug } = await params;
  const product = await getProductBySlug(slug);

  if (!product) {
    return {
      title: "Product Not Found",
      description: "The requested product could not be found.",
    };
  }

  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://localhost:3000";
  const productUrl = `${baseUrl}/products/${slug}`;
  const productImage = product.images[0]?.url;
  const productImageAlt = product.images[0]?.alt || product.name;

  // 使用 metaTitle/metaDescription 如果存在，否则使用默认值
  const title = (product as any).metaTitle || product.name;
  const description =
    (product as any).metaDescription ||
    product.description?.slice(0, 160) ||
    `Shop ${product.name} at PPE Pro. High-quality protective equipment.`;

  return {
    title,
    description,
    keywords: [
      product.name,
      product.category?.name,
      "PPE",
      "safety equipment",
      product.sku,
    ].filter(Boolean) as string[],
    openGraph: {
      title: (product as any).ogTitle || title,
      description: (product as any).ogDescription || description,
      url: productUrl,
      siteName: "PPE Pro",
      images: productImage
        ? [
            {
              url: productImage,
              width: 800,
              height: 800,
              alt: productImageAlt,
            },
          ]
        : [],
      type: "website",
      locale: "en_US",
    },
    twitter: {
      card: "summary_large_image",
      title,
      description,
      images: productImage ? [productImage] : [],
    },
    alternates: {
      canonical: productUrl,
    },
    other: {
      "product:price:amount": String(product.price),
      "product:price:currency": "USD",
      "product:availability": product.stock > 0 ? "in stock" : "out of stock",
    },
  };
}
```

---

### 3.2 任务：产品详情页添加 JSON-LD 结构化数据

**文件**: `src/components/seo/product-jsonld.tsx` (新建)

```typescript
import { Product, ProductImage, Category } from "@prisma/client";

type ProductWithRelations = Product & {
  images: ProductImage[];
  category: Category | null;
};

interface ProductJsonLdProps {
  product: ProductWithRelations;
  baseUrl: string;
}

export function ProductJsonLd({ product, baseUrl }: ProductJsonLdProps) {
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "Product",
    name: product.name,
    description: product.description,
    image: product.images.map((img) => img.url),
    sku: product.sku,
    mpn: product.sku,
    brand: {
      "@type": "Brand",
      name: "PPE Pro",
    },
    category: product.category?.name,
    url: `${baseUrl}/products/${product.slug}`,
    offers: {
      "@type": "Offer",
      url: `${baseUrl}/products/${product.slug}`,
      priceCurrency: "USD",
      price: Number(product.price),
      priceValidUntil: new Date(
        Date.now() + 30 * 24 * 60 * 60 * 1000
      ).toISOString().split("T")[0], // 30天后
      availability:
        product.stock > 0
          ? "https://schema.org/InStock"
          : "https://schema.org/OutOfStock",
      seller: {
        "@type": "Organization",
        name: "PPE Pro",
      },
    },
  };

  // 如果有原价，添加折扣信息
  if (product.comparePrice && Number(product.comparePrice) > Number(product.price)) {
    (jsonLd.offers as any).priceSpecification = {
      "@type": "PriceSpecification",
      price: Number(product.price),
      priceCurrency: "USD",
      valueAddedTaxIncluded: false,
    };
  }

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
    />
  );
}
```

**在产品详情页使用**:

修改 `src/app/(store)/products/[slug]/page.tsx`，在 return 语句中添加:

```typescript
import { ProductJsonLd } from "@/components/seo/product-jsonld";

// 在组件内部
const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://localhost:3000";

return (
  <>
    <ProductJsonLd product={product} baseUrl={baseUrl} />
    <div>
      {/* 现有的产品详情内容 */}
    </div>
  </>
);
```

---

### 3.3 任务：分类页添加 generateMetadata

**文件**: `src/app/(store)/categories/[slug]/page.tsx`

**在文件顶部添加**:
```typescript
import { Metadata } from "next";
import { getCategoryBySlug } from "@/actions/categories";

type Props = {
  params: Promise<{ slug: string }>;
};

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { slug } = await params;
  const category = await getCategoryBySlug(slug);

  if (!category) {
    return {
      title: "Category Not Found",
      description: "The requested category could not be found.",
    };
  }

  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://localhost:3000";
  const categoryUrl = `${baseUrl}/categories/${slug}`;

  const title = (category as any).metaTitle || `${category.name} Products`;
  const description =
    (category as any).metaDescription ||
    category.description ||
    `Browse our selection of ${category.name}. High-quality protective equipment from PPE Pro.`;

  return {
    title,
    description,
    openGraph: {
      title,
      description,
      url: categoryUrl,
      siteName: "PPE Pro",
      images: category.image
        ? [
            {
              url: category.image,
              width: 800,
              height: 600,
              alt: category.name,
            },
          ]
        : [],
      type: "website",
      locale: "en_US",
    },
    twitter: {
      card: "summary_large_image",
      title,
      description,
      images: category.image ? [category.image] : [],
    },
    alternates: {
      canonical: categoryUrl,
    },
  };
}
```

---

### 3.4 任务：分类页添加 JSON-LD

**文件**: `src/components/seo/category-jsonld.tsx` (新建)

```typescript
import { Category, Product } from "@prisma/client";

interface CategoryJsonLdProps {
  category: Category;
  products: Product[];
  baseUrl: string;
}

export function CategoryJsonLd({ category, products, baseUrl }: CategoryJsonLdProps) {
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: category.name,
    description: category.description,
    url: `${baseUrl}/categories/${category.slug}`,
    mainEntity: {
      "@type": "ItemList",
      numberOfItems: products.length,
      itemListElement: products.slice(0, 10).map((product, index) => ({
        "@type": "ListItem",
        position: index + 1,
        item: {
          "@type": "Product",
          name: product.name,
          url: `${baseUrl}/products/${product.slug}`,
          offers: {
            "@type": "Offer",
            price: Number(product.price),
            priceCurrency: "USD",
          },
        },
      })),
    },
  };

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
    />
  );
}
```

---

### 3.5 任务：添加 Organization JSON-LD（全站）

**文件**: `src/components/seo/organization-jsonld.tsx` (新建)

```typescript
interface OrganizationJsonLdProps {
  baseUrl: string;
}

export function OrganizationJsonLd({ baseUrl }: OrganizationJsonLdProps) {
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "Organization",
    name: "PPE Pro",
    url: baseUrl,
    logo: `${baseUrl}/logo.png`,
    description:
      "Leading manufacturer of personal protective equipment. Safety gloves, shoes, workwear, and more.",
    address: {
      "@type": "PostalAddress",
      addressCountry: "US",
    },
    contactPoint: {
      "@type": "ContactPoint",
      telephone: "+1-555-123-4567",
      contactType: "customer service",
      availableLanguage: ["English"],
    },
    sameAs: [
      // 添加社交媒体链接
      // "https://facebook.com/ppepro",
      // "https://twitter.com/ppepro",
      // "https://linkedin.com/company/ppepro",
    ],
  };

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
    />
  );
}
```

**在 Store Layout 中使用**:

修改 `src/app/(store)/layout.tsx`:
```typescript
import { OrganizationJsonLd } from "@/components/seo/organization-jsonld";

export default async function StoreLayout({ children }: { children: React.ReactNode }) {
  const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || "https://localhost:3000";

  return (
    <>
      <OrganizationJsonLd baseUrl={baseUrl} />
      {/* 现有布局内容 */}
    </>
  );
}
```

---

### 3.6 任务：产品列表页添加 Metadata

**文件**: `src/app/(store)/products/page.tsx`

```typescript
import { Metadata } from "next";

type Props = {
  searchParams: Promise<{
    category?: string;
    search?: string;
    page?: string;
  }>;
};

export async function generateMetadata({ searchParams }: Props): Promise<Metadata> {
  const { category, search, page } = await searchParams;

  let title = "All Products";
  let description = "Browse our complete selection of professional protective equipment.";

  if (search) {
    title = `Search results for "${search}"`;
    description = `Find ${search} in our collection of safety equipment.`;
  }

  if (category) {
    // 可以根据 category ID 获取分类名称
    title = `Products in Category`;
  }

  if (page && Number(page) > 1) {
    title += ` - Page ${page}`;
  }

  return {
    title,
    description,
    robots: {
      index: !search, // 搜索结果页不索引
      follow: true,
    },
  };
}
```

---

## 4. P2 - Admin端SEO配置功能

### 4.1 任务：数据库 Schema 扩展

**文件**: `prisma/schema.prisma`

**修改 Product 模型**:
```prisma
model Product {
  id             String   @id @default(cuid())
  name           String
  slug           String   @unique
  description    String?  @db.Text
  content        Json?
  specifications Json?
  price          Decimal  @db.Decimal(10, 2)
  comparePrice   Decimal? @db.Decimal(10, 2)
  cost           Decimal? @db.Decimal(10, 2)
  sku            String?  @unique
  barcode        String?
  stock          Int      @default(0)
  lowStock       Int      @default(5)
  weight         Decimal? @db.Decimal(10, 2)
  categoryId     String?
  isActive       Boolean  @default(true)
  isFeatured     Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // ===== SEO 字段 (新增) =====
  metaTitle       String?   @map("meta_title")
  metaDescription String?   @db.Text @map("meta_description")
  metaKeywords    String?   @map("meta_keywords")
  ogTitle         String?   @map("og_title")
  ogDescription   String?   @db.Text @map("og_description")
  ogImage         String?   @map("og_image")
  canonicalUrl    String?   @map("canonical_url")

  // 关系
  category        Category?               @relation(fields: [categoryId], references: [id])
  collections     ProductCollection[]
  images          ProductImage[]
  variants        ProductVariant[]
  cartItems       CartItem[]
  orderItems      OrderItem[]
  attributeValues ProductAttributeValue[]
  quoteItems      QuoteItem[]
  priceTiers      PriceTier[]

  @@index([categoryId])
  @@index([isActive, isFeatured])
  @@map("products")
}
```

**修改 Category 模型**:
```prisma
model Category {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  image       String?
  parentId    String?
  sortOrder   Int        @default(0)
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // ===== SEO 字段 (新增) =====
  metaTitle       String?   @map("meta_title")
  metaDescription String?   @db.Text @map("meta_description")

  // 关系
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[] @relation("CategoryTree")
  products Product[]

  @@map("categories")
}
```

**运行迁移**:
```bash
npx prisma migrate dev --name add_seo_fields
```

---

### 4.2 任务：更新 Products Action

**文件**: `src/actions/products.ts`

**更新 Schema 验证**:
```typescript
const productSchema = z.object({
  name: z.string().min(1, "Name is required"),
  slug: z.string().min(1, "Slug is required"),
  description: z.string().optional(),
  price: z.coerce.number().min(0, "Price must be positive"),
  comparePrice: z.coerce.number().min(0).optional().nullable(),
  cost: z.coerce.number().min(0).optional().nullable(),
  sku: z.string().optional().nullable(),
  barcode: z.string().optional().nullable(),
  stock: z.coerce.number().int().min(0).default(0),
  categoryId: z.string().optional().nullable(),
  isActive: z.boolean().default(true),
  isFeatured: z.boolean().default(false),
  images: z.array(z.string()).optional(),
  collectionIds: z.array(z.string()).optional(),
  attributeValues: z.string().optional(),
  specifications: z.string().optional(),
  content: z.string().optional(),
  priceTiers: z.string().optional(),

  // ===== SEO 字段 (新增) =====
  metaTitle: z.string().max(60).optional().nullable(),
  metaDescription: z.string().max(160).optional().nullable(),
  metaKeywords: z.string().optional().nullable(),
  ogTitle: z.string().max(60).optional().nullable(),
  ogDescription: z.string().max(200).optional().nullable(),
  ogImage: z.string().optional().nullable(),
  canonicalUrl: z.string().url().optional().nullable(),
});
```

**更新 createProduct 和 updateProduct 函数**，在 prisma.product.create/update 中添加 SEO 字段:
```typescript
await prisma.product.create({
  data: {
    // ... 现有字段
    metaTitle: validatedFields.data.metaTitle,
    metaDescription: validatedFields.data.metaDescription,
    metaKeywords: validatedFields.data.metaKeywords,
    ogTitle: validatedFields.data.ogTitle,
    ogDescription: validatedFields.data.ogDescription,
    ogImage: validatedFields.data.ogImage,
    canonicalUrl: validatedFields.data.canonicalUrl,
  },
});
```

---

### 4.3 任务：ProductForm 添加 SEO 区块

**文件**: `src/components/admin/product-form.tsx`

**添加 SEO 状态**:
```typescript
// 在现有 state 声明后添加
const [metaTitle, setMetaTitle] = useState(product?.metaTitle || "");
const [metaDescription, setMetaDescription] = useState(product?.metaDescription || "");
const [metaKeywords, setMetaKeywords] = useState(product?.metaKeywords || "");
const [ogTitle, setOgTitle] = useState(product?.ogTitle || "");
const [ogDescription, setOgDescription] = useState(product?.ogDescription || "");
const [ogImage, setOgImage] = useState(product?.ogImage || "");
```

**添加 SEO Card** (在现有 Cards 后):
```tsx
<Card>
  <CardHeader>
    <CardTitle>SEO Settings</CardTitle>
    <CardDescription>
      Optimize how this product appears in search engines and social media
    </CardDescription>
  </CardHeader>
  <CardContent className="space-y-4">
    {/* Meta Title */}
    <div className="space-y-2">
      <Label htmlFor="metaTitle">Meta Title</Label>
      <Input
        id="metaTitle"
        name="metaTitle"
        value={metaTitle}
        onChange={(e) => setMetaTitle(e.target.value)}
        placeholder={name || "Auto-generated from product name"}
        maxLength={60}
      />
      <div className="flex justify-between text-xs text-muted-foreground">
        <span>Recommended: 50-60 characters</span>
        <span className={metaTitle.length > 60 ? "text-red-500" : ""}>
          {metaTitle.length}/60
        </span>
      </div>
    </div>

    {/* Meta Description */}
    <div className="space-y-2">
      <Label htmlFor="metaDescription">Meta Description</Label>
      <Textarea
        id="metaDescription"
        name="metaDescription"
        value={metaDescription}
        onChange={(e) => setMetaDescription(e.target.value)}
        placeholder={
          description?.slice(0, 160) || "Auto-generated from product description"
        }
        rows={3}
        maxLength={160}
      />
      <div className="flex justify-between text-xs text-muted-foreground">
        <span>Recommended: 120-160 characters</span>
        <span className={metaDescription.length > 160 ? "text-red-500" : ""}>
          {metaDescription.length}/160
        </span>
      </div>
    </div>

    {/* Meta Keywords */}
    <div className="space-y-2">
      <Label htmlFor="metaKeywords">Keywords</Label>
      <Input
        id="metaKeywords"
        name="metaKeywords"
        value={metaKeywords}
        onChange={(e) => setMetaKeywords(e.target.value)}
        placeholder="safety gloves, work gloves, PPE"
      />
      <p className="text-xs text-muted-foreground">
        Comma-separated keywords (optional, low SEO impact)
      </p>
    </div>

    <Separator className="my-4" />

    <h4 className="font-medium">Social Media (Open Graph)</h4>

    {/* OG Title */}
    <div className="space-y-2">
      <Label htmlFor="ogTitle">Social Title</Label>
      <Input
        id="ogTitle"
        name="ogTitle"
        value={ogTitle}
        onChange={(e) => setOgTitle(e.target.value)}
        placeholder="Defaults to Meta Title"
      />
    </div>

    {/* OG Description */}
    <div className="space-y-2">
      <Label htmlFor="ogDescription">Social Description</Label>
      <Textarea
        id="ogDescription"
        name="ogDescription"
        value={ogDescription}
        onChange={(e) => setOgDescription(e.target.value)}
        placeholder="Defaults to Meta Description"
        rows={2}
      />
    </div>

    {/* OG Image */}
    <div className="space-y-2">
      <Label>Social Image</Label>
      <ImageUpload
        value={ogImage ? [ogImage] : []}
        onChange={(imgs) => setOgImage(imgs[0] || "")}
        maxImages={1}
      />
      <p className="text-xs text-muted-foreground">
        Recommended: 1200x630px. Defaults to first product image.
      </p>
      <input type="hidden" name="ogImage" value={ogImage} />
    </div>

    {/* SEO Preview */}
    <div className="mt-6 p-4 bg-muted rounded-lg">
      <h4 className="text-sm font-medium mb-2">Search Preview</h4>
      <div className="space-y-1">
        <p className="text-blue-600 text-lg truncate">
          {metaTitle || name || "Product Title"}
        </p>
        <p className="text-green-700 text-sm">
          {process.env.NEXT_PUBLIC_SITE_URL || "https://example.com"}/products/
          {slug || "product-slug"}
        </p>
        <p className="text-sm text-muted-foreground line-clamp-2">
          {metaDescription || description?.slice(0, 160) || "Product description..."}
        </p>
      </div>
    </div>
  </CardContent>
</Card>
```

---

### 4.4 任务：Admin Settings 添加 SEO 标签

**文件**: `src/app/admin/settings/page.tsx`

**添加 SEO Tab**:
```tsx
// 在 TabsList 中添加
<TabsTrigger value="seo">SEO</TabsTrigger>

// 添加 SEO TabsContent
<TabsContent value="seo" className="space-y-6">
  {/* Global SEO Settings */}
  <Card>
    <CardHeader>
      <CardTitle className="font-serif">Global SEO Settings</CardTitle>
      <CardDescription>
        Default settings for all pages. Individual pages can override these.
      </CardDescription>
    </CardHeader>
    <CardContent className="space-y-4">
      <div className="space-y-2">
        <Label htmlFor="defaultTitle">Default Page Title</Label>
        <Input
          id="defaultTitle"
          defaultValue="PPE Pro | Professional Safety Equipment"
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="titleTemplate">Title Template</Label>
        <Input id="titleTemplate" defaultValue="%s | PPE Pro" />
        <p className="text-sm text-muted-foreground">
          %s will be replaced with the page title
        </p>
      </div>
      <div className="space-y-2">
        <Label htmlFor="defaultDescription">Default Meta Description</Label>
        <Textarea
          id="defaultDescription"
          rows={3}
          defaultValue="Leading manufacturer of personal protective equipment. Safety gloves, shoes, workwear, and more."
        />
      </div>
      <Button>Save Changes</Button>
    </CardContent>
  </Card>

  {/* Search Engine Verification */}
  <Card>
    <CardHeader>
      <CardTitle className="font-serif">Search Engine Verification</CardTitle>
      <CardDescription>
        Add verification codes for search engine webmaster tools
      </CardDescription>
    </CardHeader>
    <CardContent className="space-y-4">
      <div className="space-y-2">
        <Label htmlFor="googleVerification">Google Search Console</Label>
        <Input
          id="googleVerification"
          placeholder="google-site-verification=xxxxx"
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor="bingVerification">Bing Webmaster Tools</Label>
        <Input id="bingVerification" placeholder="msvalidate.01=xxxxx" />
      </div>
      <div className="space-y-2">
        <Label htmlFor="yandexVerification">Yandex Webmaster</Label>
        <Input id="yandexVerification" placeholder="yandex-verification=xxxxx" />
      </div>
      <Button>Save Changes</Button>
    </CardContent>
  </Card>

  {/* Social Media Defaults */}
  <Card>
    <CardHeader>
      <CardTitle className="font-serif">Social Media Defaults</CardTitle>
      <CardDescription>
        Default settings for social media sharing
      </CardDescription>
    </CardHeader>
    <CardContent className="space-y-4">
      <div className="space-y-2">
        <Label>Default OG Image</Label>
        {/* Use ImageUpload component */}
        <p className="text-sm text-muted-foreground">
          Recommended: 1200x630px
        </p>
      </div>
      <div className="space-y-2">
        <Label htmlFor="twitterHandle">Twitter Handle</Label>
        <Input id="twitterHandle" placeholder="@yourhandle" />
      </div>
      <div className="space-y-2">
        <Label htmlFor="facebookAppId">Facebook App ID</Label>
        <Input id="facebookAppId" placeholder="Optional" />
      </div>
      <Button>Save Changes</Button>
    </CardContent>
  </Card>

  {/* Robots.txt Configuration */}
  <Card>
    <CardHeader>
      <CardTitle className="font-serif">Robots.txt Configuration</CardTitle>
      <CardDescription>
        Control how search engines crawl your site
      </CardDescription>
    </CardHeader>
    <CardContent className="space-y-4">
      <div className="space-y-2">
        <Label htmlFor="robotsRules">Custom Rules</Label>
        <Textarea
          id="robotsRules"
          rows={8}
          className="font-mono text-sm"
          defaultValue={`User-agent: *
Allow: /
Disallow: /admin/
Disallow: /api/
Disallow: /checkout/
Disallow: /account/

Sitemap: ${process.env.NEXT_PUBLIC_SITE_URL || "https://example.com"}/sitemap.xml`}
        />
      </div>
      <Button>Save Changes</Button>
    </CardContent>
  </Card>
</TabsContent>
```

---

### 4.5 任务：创建 SEO Settings Action

**文件**: `src/actions/seo-settings.ts` (新建)

```typescript
"use server";

import prisma from "@/lib/prisma";
import { revalidatePath } from "next/cache";

export interface SeoSettings {
  defaultTitle: string;
  titleTemplate: string;
  defaultDescription: string;
  googleVerification?: string;
  bingVerification?: string;
  yandexVerification?: string;
  defaultOgImage?: string;
  twitterHandle?: string;
  facebookAppId?: string;
  customRobotsTxt?: string;
}

const SEO_SETTINGS_KEY = "seo_settings";

export async function getSeoSettings(): Promise<SeoSettings | null> {
  const setting = await prisma.setting.findUnique({
    where: { key: SEO_SETTINGS_KEY },
  });

  return setting?.value as SeoSettings | null;
}

export async function updateSeoSettings(data: SeoSettings) {
  await prisma.setting.upsert({
    where: { key: SEO_SETTINGS_KEY },
    update: { value: data as any },
    create: { key: SEO_SETTINGS_KEY, value: data as any },
  });

  revalidatePath("/admin/settings");
  revalidatePath("/");
}
```

---

## 5. P3 - 进阶优化

### 5.1 任务：ProductImage Alt 文本管理

**更新 ImageUpload 组件** (`src/components/admin/image-upload.tsx`)

添加 alt 文本输入功能:
```tsx
interface ImageUploadProps {
  value: string[];
  onChange: (urls: string[]) => void;
  alts?: string[];
  onAltsChange?: (alts: string[]) => void;
  maxImages?: number;
  productName?: string;
}

// 在每个图片预览下方添加 alt 输入
{value.map((url, index) => (
  <div key={url} className="relative group">
    <Image src={url} alt={alts?.[index] || ""} ... />
    <Input
      placeholder="Image description for SEO"
      value={alts?.[index] || ""}
      onChange={(e) => {
        const newAlts = [...(alts || [])];
        newAlts[index] = e.target.value;
        onAltsChange?.(newAlts);
      }}
      className="mt-2 text-sm"
    />
  </div>
))}
```

---

### 5.2 任务：添加 Breadcrumb JSON-LD

**文件**: `src/components/seo/breadcrumb-jsonld.tsx` (新建)

```typescript
interface BreadcrumbItem {
  name: string;
  url: string;
}

interface BreadcrumbJsonLdProps {
  items: BreadcrumbItem[];
}

export function BreadcrumbJsonLd({ items }: BreadcrumbJsonLdProps) {
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: items.map((item, index) => ({
      "@type": "ListItem",
      position: index + 1,
      name: item.name,
      item: item.url,
    })),
  };

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
    />
  );
}
```

**在产品详情页使用**:
```tsx
<BreadcrumbJsonLd
  items={[
    { name: "Home", url: baseUrl },
    { name: "Products", url: `${baseUrl}/products` },
    ...(product.category
      ? [{ name: product.category.name, url: `${baseUrl}/categories/${product.category.slug}` }]
      : []),
    { name: product.name, url: `${baseUrl}/products/${product.slug}` },
  ]}
/>
```

---

### 5.3 任务：添加 FAQ JSON-LD (可选)

**文件**: `src/components/seo/faq-jsonld.tsx` (新建)

```typescript
interface FaqItem {
  question: string;
  answer: string;
}

interface FaqJsonLdProps {
  faqs: FaqItem[];
}

export function FaqJsonLd({ faqs }: FaqJsonLdProps) {
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    mainEntity: faqs.map((faq) => ({
      "@type": "Question",
      name: faq.question,
      acceptedAnswer: {
        "@type": "Answer",
        text: faq.answer,
      },
    })),
  };

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
    />
  );
}
```

---

### 5.4 任务：国际化 SEO 支持 (可选)

如需多语言支持，添加 hreflang 标签:

**更新 `src/app/layout.tsx`**:
```typescript
export const metadata: Metadata = {
  // ...现有配置
  alternates: {
    canonical: process.env.NEXT_PUBLIC_SITE_URL,
    languages: {
      "en-US": `${process.env.NEXT_PUBLIC_SITE_URL}/en`,
      "zh-CN": `${process.env.NEXT_PUBLIC_SITE_URL}/zh`,
      // 添加更多语言
    },
  },
};
```

---

## 6. 验证清单

### 6.1 技术验证

- [ ] 访问 `/sitemap.xml` 确认正确生成
- [ ] 访问 `/robots.txt` 确认正确生成
- [ ] 使用浏览器开发工具检查每个页面的 `<head>` 标签
- [ ] 验证 JSON-LD 结构化数据 (https://search.google.com/test/rich-results)
- [ ] 使用 Lighthouse 运行 SEO 审计

### 6.2 Google Search Console

- [ ] 提交 sitemap
- [ ] 检查索引状态
- [ ] 修复任何爬取错误
- [ ] 验证移动端可用性

### 6.3 社交媒体测试

- [ ] Facebook Sharing Debugger: https://developers.facebook.com/tools/debug/
- [ ] Twitter Card Validator: https://cards-dev.twitter.com/validator
- [ ] LinkedIn Post Inspector: https://www.linkedin.com/post-inspector/

### 6.4 页面级检查

| 页面 | Metadata | OG Tags | JSON-LD | Canonical |
|------|----------|---------|---------|-----------|
| 首页 | [ ] | [ ] | [ ] Organization | [ ] |
| 产品列表 | [ ] | [ ] | - | [ ] |
| 产品详情 | [ ] | [ ] | [ ] Product + Breadcrumb | [ ] |
| 分类列表 | [ ] | [ ] | - | [ ] |
| 分类详情 | [ ] | [ ] | [ ] CollectionPage | [ ] |
| 关于我们 | [ ] | [ ] | - | [ ] |

---

## 附录

### A. 推荐工具

- **SEO分析**: Ahrefs, SEMrush, Moz
- **技术SEO**: Screaming Frog, Sitebulb
- **性能**: Google PageSpeed Insights, WebPageTest
- **结构化数据**: Google Rich Results Test

### B. 环境变量清单

```bash
# .env
NEXT_PUBLIC_SITE_URL=https://your-production-domain.com
NEXT_PUBLIC_PROJECT_TYPE=B2C
```

### C. 文件变更清单

| 文件 | 操作 | 优先级 |
|------|------|--------|
| `src/app/layout.tsx` | 修改 | P0 |
| `src/app/sitemap.ts` | 新建 | P0 |
| `src/app/robots.ts` | 新建 | P0 |
| `src/app/(store)/products/[slug]/page.tsx` | 修改 | P1 |
| `src/app/(store)/categories/[slug]/page.tsx` | 修改 | P1 |
| `src/app/(store)/products/page.tsx` | 修改 | P1 |
| `src/components/seo/product-jsonld.tsx` | 新建 | P1 |
| `src/components/seo/category-jsonld.tsx` | 新建 | P1 |
| `src/components/seo/organization-jsonld.tsx` | 新建 | P1 |
| `src/components/seo/breadcrumb-jsonld.tsx` | 新建 | P3 |
| `prisma/schema.prisma` | 修改 | P2 |
| `src/actions/products.ts` | 修改 | P2 |
| `src/components/admin/product-form.tsx` | 修改 | P2 |
| `src/app/admin/settings/page.tsx` | 修改 | P2 |
| `src/actions/seo-settings.ts` | 新建 | P2 |
| `public/og-image.jpg` | 新建 | P0 |

---

*文档版本: 1.0*
*创建日期: 2025-01-23*
*基于项目: B2C E-commerce (Next.js 16 + Prisma)*
